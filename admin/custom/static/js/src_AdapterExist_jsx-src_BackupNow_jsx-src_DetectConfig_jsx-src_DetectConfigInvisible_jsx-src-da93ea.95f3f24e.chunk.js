"use strict";(self.webpackChunkiobroker_admin_component_backitup=self.webpackChunkiobroker_admin_component_backitup||[]).push([["src_AdapterExist_jsx-src_BackupNow_jsx-src_DetectConfig_jsx-src_DetectConfigInvisible_jsx-src-da93ea"],{1810:(k,x,n)=>{n.d(x,{A:()=>s});var p=n(28437),i=n.n(p),A=n(95973),c=n.n(A),E=n(37449),W=n.n(E),y=n(67085),L=n.n(y),O=n(85903),U=Object.defineProperty,D=Object.defineProperties,P=Object.getOwnPropertyDescriptors,T=Object.getOwnPropertySymbols,M=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable,B=(a,t,l)=>t in a?U(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,v=(a,t)=>{for(var l in t||(t={}))M.call(t,l)&&B(a,l,t[l]);if(T)for(var l of T(t))R.call(t,l)&&B(a,l,t[l]);return a},o=(a,t)=>D(a,P(t)),e=(a,t,l)=>new Promise((h,d)=>{var m=_=>{try{b(l.next(_))}catch(g){d(g)}},I=_=>{try{b(l.throw(_))}catch(g){d(g)}},b=_=>_.done?h(_.value):Promise.resolve(_.value).then(m,I);b((l=l.apply(a,t)).next())});class r extends O.A{renderItem(){return i().createElement(i().Fragment,null,i().createElement(y.FormControlLabel,{control:i().createElement(y.Checkbox,{checked:this.props.data[this.props.attr]||!1,onChange:t=>e(this,null,function*(){if(t.target.checked){if(this.props.schema.adapter)this.checkAdapterInstall(this.props.schema.adapter,this.props.schema.allHosts).catch(l=>console.error(l));else if(this.props.schema.alert){const h=E.I18n.t(this.props.schema.alert).split(`
`).map(d=>i().createElement("div",{key:d,style:{minHeight:24}},d));this.setState({message:{text:h,title:E.I18n.t(this.props.schema.title)}})}}this.props.onChange(o(v({},this.props.data),{[this.props.attr]:t.target.checked}))})}),label:E.I18n.t(this.props.schema.label||this.props.schema.adapter)}),this.renderMessage())}}r.propTypes={socket:c().object.isRequired,themeType:c().string,themeName:c().string,style:c().object,className:c().string,data:c().object.isRequired,attr:c().string,schema:c().object,onError:c().func,onChange:c().func};const s=r},98360:(k,x,n)=>{n.d(x,{A:()=>_});var p=n(28437),i=n.n(p),A=n(95973),c=n.n(A),E=n(70143),W=n.n(E),y=n(37449),L=n.n(y),O=n(67085),U=n.n(O),D=n(21839),P=n.n(D),T=Object.defineProperty,M=Object.defineProperties,R=Object.getOwnPropertyDescriptors,B=Object.getOwnPropertySymbols,v=Object.getPrototypeOf,o=Object.prototype.hasOwnProperty,e=Object.prototype.propertyIsEnumerable,r=Reflect.get,s=(g,u,f)=>u in g?T(g,u,{enumerable:!0,configurable:!0,writable:!0,value:f}):g[u]=f,a=(g,u)=>{for(var f in u||(u={}))o.call(u,f)&&s(g,f,u[f]);if(B)for(var f of B(u))e.call(u,f)&&s(g,f,u[f]);return g},t=(g,u)=>M(g,R(u)),l=(g,u,f)=>(s(g,typeof u!="symbol"?u+"":u,f),f),h=(g,u,f)=>r(v(g),f,u),d=(g,u,f)=>new Promise((C,j)=>{var K=S=>{try{N(f.next(S))}catch(w){j(w)}},F=S=>{try{N(f.throw(S))}catch(w){j(w)}},N=S=>S.done?C(S.value):Promise.resolve(S.value).then(K,F);N((f=f.apply(g,u)).next())});const m={paper:{height:"calc(100% - 64px)"},fullHeight:{height:"100%","& .MuiInputBase-root":{height:"100%"}},textLevel:{display:"inline-block",width:40},"textLevel-ERROR":{color:"red"},"textLevel-WARN":{color:"orange"},textSource:{display:"inline-block",width:70,marginRight:8,textAlign:"right"},text:{display:"inline-block"}},I=`[ERROR] [iobroker] - Debugger listening on ws://127.0.0.1:52136/a2d4655f-b965-4e25-b07c-3ef13725d923
For help, see: https://nodejs.org/en/docs/inspector

[ERROR] [iobroker] - Debugger attached.

[DEBUG] [iobroker] - host.MSI 11856 states saved

[DEBUG] [iobroker] - host.MSI 14814 objects saved

[ERROR] [iobroker] - host.MSI Please ensure that self-created JSON files are valid

[DEBUG] [iobroker] - This backup can only be restored with js-controller version up from 4.1

[ERROR] [iobroker] - Waiting for the debugger to disconnect...

[DEBUG] [iobroker] - done
[DEBUG] [influxDB] - InfluxDB-Backup started ...
[DEBUG] [influxDB] - InfluxDB Backup tmp directory created 
[DEBUG] [influxDB] - done
[ERROR] [sqlite] - Error: Command failed: sqlite3  .dump > C:\\pWork\\backups\\sqlite_2024_04_05-22_45_53_backupiobroker.sql
Der Befehl "sqlite3" ist entweder falsch geschrieben oder
konnte nicht gefunden werden.
`;class b extends y.ConfigGeneric{constructor(u){super(u),l(this,"onOutput",(f,C)=>{if(C&&C.val&&C.val!==this.lastExecutionLine){this.lastExecutionLine=C.val;const j=[...this.state.executionLog];if(j.push(C.val),this.setState({executionLog:j}),C.val.startsWith("[EXIT]")){this.setState({executing:!1});const K=C.val.match(/^\[EXIT] ([-\d]+)/);this.state.closeOnReady&&(!K||K[1]==="0")&&(this.closeTimeout=this.closeTimeout||setTimeout(()=>{this.closeTimeout=null,this.setState({executionDialog:!1})},1500))}}}),l(this,"onEnabled",(f,C)=>{f===`${this.props.adapterName}.${this.props.instance}.oneClick.${this.props.schema.backUpType}`&&!!(C!=null&&C.val)!==this.state.executing&&this.setState({executing:!!(C!=null&&C.val)})}),this.state=t(a({},this.state),{executing:!1,executionDialog:!1,executionLog:[],closeOnReady:!1}),this.lastExecutionLine="",this.textRef=i().createRef()}componentDidMount(){return d(this,null,function*(){h(b.prototype,this,"componentDidMount").call(this),yield this.props.socket.subscribeState(`${this.props.adapterName}.${this.props.instance}.oneClick.${this.props.schema.backUpType}`,this.onEnabled),yield this.props.socket.subscribeState(`${this.props.adapterName}.${this.props.instance}.output.line`,this.onOutput)})}componentWillUnmount(){super.componentWillUnmount(),this.props.socket.unsubscribeState(`${this.props.adapterName}.${this.props.instance}.oneClick.${this.props.schema.backUpType}`,this.onEnabled),this.props.socket.unsubscribeState(`${this.props.adapterName}.${this.props.instance}.output.line`,this.onOutput),this.closeTimeout&&clearTimeout(this.closeTimeout),this.closeTimeout=null}renderLine(u,f){const C=u.match(/^\[(\w+)] \[(\w+)] - (.*)/);return C?i().createElement("div",{key:f},i().createElement("div",{className:`${this.props.classes.textLevel} ${this.props.classes[`textLevel-${C[1]}`]}`},C[1]),i().createElement("div",{className:this.props.classes.textSource},C[2]),i().createElement("div",{className:this.props.classes.text},C[3])):i().createElement("div",{key:f},i().createElement("div",{className:this.props.classes.textLevel}),i().createElement("div",{className:this.props.classes.textSource}),i().createElement("div",{className:this.props.classes.text},u))}renderExecutionDialog(){return this.state.executionDialog?i().createElement(O.Dialog,{open:!0,onClose:()=>this.setState({executionDialog:!1}),maxWidth:"md",fullWidth:!0,classes:{paper:this.props.classes.paper}},i().createElement(O.DialogTitle,null,y.I18n.t("BackItUp execution:")),i().createElement(O.DialogContent,{style:{position:"relative"}},this.state.executing?i().createElement(O.LinearProgress,{style:{position:"absolute",top:0,left:24,width:"calc(100% - 48px)"}}):null,i().createElement("div",{style:{height:"calc(100% - 16px - 4px)",width:"calc(100% - 16px)",fontSize:12,fontFamily:"monospace",marginTop:4,padding:8},ref:this.textRef},this.state.executionLog.map((u,f)=>this.renderLine(u,f)))),i().createElement(O.DialogActions,null,i().createElement(O.FormControlLabel,{control:i().createElement(O.Checkbox,{disabled:!this.state.executing,checked:this.state.closeOnReady,onChange:u=>this.setState({closeOnReady:u.target.checked})}),label:y.I18n.t("Close on ready")}),i().createElement(O.Button,{variant:"contained",onClick:()=>this.setState({executionDialog:!1})},y.I18n.t("Close")))):null}renderItem(){return i().createElement(i().Fragment,null,i().createElement(O.Button,{disabled:!this.props.alive||this.state.executing,onClick:()=>this.setState({executionDialog:!0,executionLog:I.split(`
`),executing:!0},()=>d(this,null,function*(){this.lastExecutionLine=""})),color:this.props.color,variant:"contained",endIcon:i().createElement(D.CloudUpload,null)},this.props.schema.label?y.I18n.t(this.props.schema.label):y.I18n.t("Backup now")),this.renderExecutionDialog())}}b.propTypes={socket:c().object.isRequired,themeType:c().string,style:c().object,schema:c().object,onError:c().func};const _=(0,E.withStyles)(m)(b)},85903:(k,x,n)=>{n.d(x,{A:()=>B});var p=n(37449),i=n.n(p),A=n(28437),c=Object.defineProperty,E=Object.defineProperties,W=Object.getOwnPropertyDescriptors,y=Object.getOwnPropertySymbols,L=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,U=(v,o,e)=>o in v?c(v,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):v[o]=e,D=(v,o)=>{for(var e in o||(o={}))L.call(o,e)&&U(v,e,o[e]);if(y)for(var e of y(o))O.call(o,e)&&U(v,e,o[e]);return v},P=(v,o)=>E(v,W(o)),T=(v,o,e)=>(U(v,typeof o!="symbol"?o+"":o,e),e),M=(v,o,e)=>new Promise((r,s)=>{var a=h=>{try{l(e.next(h))}catch(d){s(d)}},t=h=>{try{l(e.throw(h))}catch(d){s(d)}},l=h=>h.done?r(h.value):Promise.resolve(h.value).then(a,t);l((e=e.apply(v,o)).next())});class R extends p.ConfigGeneric{constructor(o){super(o),T(this,"fetchConfig",(e,r)=>M(this,null,function*(){e==="ccu"?yield this.fetchCcuConfig(r):e==="mySql"?yield this.fetchMySqlConfig(r):e==="sqlite"?yield this.fetchSqliteConfig(r):e==="pgSql"?yield this.fetchPgSqlConfig(r):e==="influxDB"?yield this.fetchInfluxDBConfig(r):e==="history"?yield this.fetchHistoryConfig(r):this.showMessage(p.I18n.t("BackItUp Warning!"),p.I18n.t("Unknown config type %s",e))})),T(this,"checkAdapterInstall",(e,r)=>M(this,null,function*(){const s=this.props.common.host,a=!1;let t=e;(e==="pgsql"||e==="mysql"||e==="sqlite")&&(t="sql");const l=["zigbee","esphome","zigbee2mqtt","node-red","yahka","jarvis","history"];if(!a){const h=Object.values(yield this.props.socket.getObjectViewCustom("system","instance",`system.adapter.${t}.`,`system.adapter.${t}.\u9999`));if(h!=null&&h.length){let d=!1;for(let m=0;m<h.length;m++)if(h[m].common.host===s||r){d=!0;break}!d&&l.includes(t)&&this.showMessage(p.I18n.t("BackItUp Warning!"),p.I18n.t('No "%s" Instance found on this host. Please check your system',t))}else if(l.includes(t))return this.showMessage(p.I18n.t("BackItUp Warning!"),p.I18n.t('No "%s" Instance found. Please check your system',t)),!1}})),T(this,"showMessage",(e,r)=>{this.setState({message:{title:e,text:r}})}),this.state.message=!1}isConfigFilled(o){return o==="ccu"?!!this.props.data.ccuHost&&!!this.props.data.ccuEnabled:o==="mySql"?!!this.props.data.mySqlUser&&!!this.props.data.mySqlEnabled:o==="sqlite"?!!this.props.data.sqlitePath&&!!this.props.data.sqliteEnabled:o==="pgSql"?!!this.props.data.pgSqlUser&&!!this.props.data.pgSqlEnabled:o==="influxDB"?!!this.props.data.influxDBName&&!!this.props.data.influxDBEnabled:o==="history"?!!this.props.data.historyPath&&!!this.props.data.historyEnabled:(this.showMessage(p.I18n.t("BackItUp Warning!"),p.I18n.t("Unknown config type %s",o)),!1)}fetchCcuConfig(o){return M(this,null,function*(){const e=Object.values(yield this.props.socket.getObjectViewCustom("system","instance","system.adapter.hm-rpc.","system.adapter.hm-rpc.\u9999"));let r=!1;if(e&&e.length){for(let s=0;s<e.length;s++)if(e[s].common.enabled){const t=e[s].native;this.props.onChange(P(D({},this.props.data),{ccuHost:t.homematicAddress,ccuUsehttps:t.useHttps})),r=e[s]._id;break}if(!r)for(let s=0;s<e.length;s++){const a=e[s].native;this.props.onChange(P(D({},this.props.data),{ccuHost:a.homematicAddress,ccuUsehttps:a.useHttps})),r=e[s]._id}}r?(r=r.substring(15),!o&&this.showMessage(p.I18n.t("BackItUp Information!"),p.I18n.t("Config taken from %s",r))):!o&&this.showMessage(p.I18n.t("BackItUp Warning!"),p.I18n.t("No config found"))})}fetchMySqlConfig(o){return M(this,null,function*(){const e=Object.values(yield this.props.socket.getObjectViewCustom("system","instance","system.adapter.sql.","system.adapter.sql.\u9999"));let r=!1;if(e&&e.length){for(let s=0;s<e.length;s++){const a=e[s].common,t=e[s].native;if(a.enabled&&t.dbtype==="mysql"){this.props.onChange(P(D({},this.props.data),{mySqlUser:t.user,mySqlPassword:t.password,mySqlHost:t.host,mySqlPort:t.port==="0"?3306:t.port||3306,mySqlName:t.dbname})),r=e[s]._id;break}}if(!r)for(let s=0;s<e.length;s++){const a=e[s].native;if(a.dbtype==="mysql"){this.props.onChange(P(D({},this.props.data),{mySqlUser:a.user,mySqlPassword:a.password,mySqlHost:a.host,mySqlPort:a.port==="0"?3306:a.port||3306,mySqlName:a.dbname})),r=e[s]._id;break}}}r?(r=r.substring(15),!o&&this.showMessage(p.I18n.t("BackItUp Information!"),p.I18n.t("Config taken from %s",r))):!o&&this.showMessage(p.I18n.t("BackItUp Warning!"),p.I18n.t("No config found"))})}fetchSqliteConfig(o){return M(this,null,function*(){const e=Object.values(yield this.props.socket.getObjectViewCustom("system","instance","system.adapter.sql.","system.adapter.sql.\u9999"));let r=!1;if(e&&e.length){for(let s=0;s<e.length;s++){const a=e[s].common,t=e[s].native;if(a.enabled&&t&&t.dbtype==="sqlite"&&t.fileName){const l=t.fileName.split("/");this.props.onChange(P(D({},this.props.data),{sqlitePath:l>1?t.fileName:`/opt/iobroker/iobroker-data/sqlite/${t.fileName}`})),r=e[s]._id;break}}if(!r)for(let s=0;s<e.length;s++){const a=e[s].native;if(a&&a.dbtype==="sqlite"&&a.fileName){const t=a.fileName.split("/");this.props.onChange(P(D({},this.props.data),{sqlitePath:t>1?a.fileName:`/opt/iobroker/iobroker-data/sqlite/${a.fileName}`})),r=e[s]._id;break}}}r?(r=r.substring(15),!o&&this.showMessage(p.I18n.t("BackItUp Information!"),p.I18n.t("Config taken from %s",r))):!o&&this.showMessage(p.I18n.t("BackItUp Warning!"),p.I18n.t("No config found"))})}fetchPgSqlConfig(o){return M(this,null,function*(){const e=Object.values(yield this.props.socket.getObjectViewCustom("system","instance","system.adapter.sql.","system.adapter.sql.\u9999"));let r=!1;if(e&&e.length){for(let s=0;s<e.length;s++){const a=e[s].common,t=e[s].native;if(a.enabled&&t.dbtype==="postgresql"){this.props.onChange(P(D({},this.props.data),{pgSqlUser:t.user,pgSqlPassword:t.password,pgSqlHost:t.host,pgSqlPort:t.port==="0"?5432:t.port||5432,pgSqlName:t.dbname})),r=e[s]._id;break}}if(!r)for(let s=0;s<e.length;s++){const a=e[s].native;if(a.dbtype==="postgresql"){this.props.onChange(P(D({},this.props.data),{pgSqlUser:a.user,pgSqlPassword:a.password,pgSqlHost:a.host,pgSqlPort:a.port==="0"?5432:a.port||5432,pgSqlName:a.dbname})),r=e[s]._id;break}}}r?(r=r.substring(15),!o&&this.showMessage(p.I18n.t("BackItUp Information!"),p.I18n.t("Config taken from %s",r))):!o&&this.showMessage(p.I18n.t("BackItUp Warning!"),p.I18n.t("No config found"))})}fetchInfluxDBConfig(o){return M(this,null,function*(){const e=Object.values(yield this.props.socket.getObjectViewCustom("system","instance","system.adapter.influxdb.","system.adapter.influxdb.\u9999"));let r=!1;if(e&&e.length){for(let s=0;s<e.length;s++){const a=e[s].common,t=e[s].native;if(a.enabled){const l={influxDBHost:t.host,influxDBVersion:t.dbversion,influxDBProtocol:t.protocol,influxDBName:t.dbname};t.port&&t.dbversion&&t.dbversion==="2.x"&&(l.influxDBPort=t.port),this.props.onChange(P(D({},this.props.data),{settings:l})),r=e[s]._id;break}}if(!r&&e.length&&e[0].native){const s=e[0].native,a={influxDBHost:s.host,influxDBVersion:s.dbversion,influxDBProtocol:s.protocol,influxDBName:s.dbname};s.port&&s.dbversion&&s.dbversion==="2.x"&&(a.influxDBPort=s.port),this.props.onChange(P(D({},this.props.data),{settings:a})),r=e[0]._id}}r?(r=r.substring(15),!o&&this.showMessage(p.I18n.t("BackItUp Information!"),p.I18n.t("Config taken from %s",r))):!o&&this.showMessage(p.I18n.t("BackItUp Warning!"),p.I18n.t("No config found"))})}fetchHistoryConfig(o){return M(this,null,function*(){const e=Object.values(yield this.props.socket.getObjectViewCustom("system","instance","system.adapter.history.","system.adapter.history.\u9999"));let r="",s=!1;if(e&&e.length){for(let a=0;a<e.length;a++){const t=e[a].common,l=e[a].native;if(t.enabled){this.props.onChange(P(D({},this.props.data),{historyPath:l.storeDir&&!l.storeDir.startsWith("/opt/iobroker/backups")?l.storeDir:"/opt/iobroker/iobroker-data/history"})),r=l.storeDir,s=e[a]._id;break}}if(!s)for(let a=0;a<e.length;a++){const t=e[a].native;this.props.onChange(P(D({},this.props.data),{historyPath:t.storeDir&&!t.storeDir.startsWith("/opt/iobroker/backups")?t.storeDir:"/opt/iobroker/iobroker-data/history"})),r=t.storeDir,s=e[a]._id}}s&&!r?(s=s.substring(15),!o&&this.showMessage(p.I18n.t(`No storage path of %s is configured.
The default path of the history adapter has been set.`,s),p.I18n.t("BackItUp Information!"))):s&&r&&r.startsWith("/opt/iobroker/backups")?(s=s.substring(15),!o&&this.showMessage(p.I18n.t(`The storage path of %s must not be identical to the path for backups.
The default path of the history adapter has been set.

Please change the path in the history adapter!`,s),p.I18n.t("BackItUp Information!"))):s&&r?(s=s.substring(15),!o&&this.showMessage(p.I18n.t("Config taken from %s",s),p.I18n.t("BackItUp Information!"))):!o&&this.showMessage(p.I18n.t("No config found"),p.I18n.t("BackItUp Warning!"))})}renderMessage(){return this.state.message?A.createElement(p.Message,{title:this.state.message.title,text:this.state.message.text,onClose:()=>this.setState({message:!1})}):null}}const B=R},86207:(k,x,n)=>{n.d(x,{A:()=>M});var p=n(28437),i=n.n(p),A=n(95973),c=n.n(A),E=n(67085),W=n.n(E),y=n(21839),L=n.n(y),O=n(37449),U=n.n(O),D=n(85903),P=(R,B,v)=>new Promise((o,e)=>{var r=t=>{try{a(v.next(t))}catch(l){e(l)}},s=t=>{try{a(v.throw(t))}catch(l){e(l)}},a=t=>t.done?o(t.value):Promise.resolve(t.value).then(r,s);a((v=v.apply(R,B)).next())});class T extends D.A{renderItem(){return i().createElement(i().Fragment,null,i().createElement(E.Button,{variant:"contained",endIcon:i().createElement(y.Search,null),onClick:()=>P(this,null,function*(){yield this.fetchConfig(this.props.schema.adapter)})},O.I18n.t("Detect config")),this.renderMessage())}}T.propTypes={socket:c().object.isRequired,themeType:c().string,themeName:c().string,style:c().object,className:c().string,data:c().object.isRequired,attr:c().string,schema:c().object,onError:c().func,onChange:c().func};const M=T},5742:(k,x,n)=>{n.d(x,{A:()=>O});var p=n(95973),i=n.n(p),A=n(85903),c=Object.getPrototypeOf,E=Reflect.get,W=(U,D,P)=>E(c(U),P,D),y=(U,D,P)=>new Promise((T,M)=>{var R=o=>{try{v(P.next(o))}catch(e){M(e)}},B=o=>{try{v(P.throw(o))}catch(e){M(e)}},v=o=>o.done?T(o.value):Promise.resolve(o.value).then(R,B);v((P=P.apply(U,D)).next())});class L extends A.A{componentDidMount(){return y(this,null,function*(){W(L.prototype,this,"componentDidMount").call(this),this.isConfigFilled(this.props.schema.adapter)||(yield this.fetchConfig(this.props.schema.adapter,!0))})}renderItem(){return this.renderMessage()}}L.propTypes={socket:i().object.isRequired,themeType:i().string,themeName:i().string,style:i().object,className:i().string,data:i().object.isRequired,attr:i().string,schema:i().object,onError:i().func,onChange:i().func};const O=L},35665:(k,x,n)=>{n.d(x,{A:()=>a});var p=n(28437),i=n.n(p),A=n(95973),c=n.n(A),E=n(67085),W=n.n(E),y=n(21839),L=n.n(y),O=n(37449),U=n.n(O),D=Object.defineProperty,P=Object.defineProperties,T=Object.getOwnPropertyDescriptors,M=Object.getOwnPropertySymbols,R=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable,v=(t,l,h)=>l in t?D(t,l,{enumerable:!0,configurable:!0,writable:!0,value:h}):t[l]=h,o=(t,l)=>{for(var h in l||(l={}))R.call(l,h)&&v(t,h,l[h]);if(M)for(var h of M(l))B.call(l,h)&&v(t,h,l[h]);return t},e=(t,l)=>P(t,T(l)),r=(t,l,h)=>new Promise((d,m)=>{var I=g=>{try{_(h.next(g))}catch(u){m(u)}},b=g=>{try{_(h.throw(g))}catch(u){m(u)}},_=g=>g.done?d(g.value):Promise.resolve(g.value).then(I,b);_((h=h.apply(t,l)).next())});class s extends O.ConfigGeneric{renderItem(){return i().createElement("div",{style:{width:"100%"}},i().createElement(E.Button,{disabled:!this.props.alive||this.state.running,endIcon:i().createElement(y.CloudUpload,null),variant:"contained",onClick:()=>this.setState({running:!0},()=>r(this,null,function*(){const l=yield this.props.socket.sendTo(`${this.props.adapterName}.${this.props.instance}`,"authGoogleDrive");this.setState({googleDriveUrl:l.url,running:!1})}))},O.i18n.t(this.props.data.googledriveAccessTokens?"Renew google drive access":"Get google drive access")),this.state.googleDriveUrl?i().createElement(i().Fragment,null,i().createElement("div",{style:{width:"100%"}},`${O.i18n.t("Authorize this app by visiting this url")}: `,i().createElement("a",{target:"_blank",href:this.state.googleDriveUrl,rel:"noreferrer"},this.state.googleDriveUrl)),i().createElement(E.TextField,{label:O.i18n.t("Enter the code from that page here"),variant:"standard",value:this.props.data.googledriveAccessTokens||"",onChange:l=>this.props.onChange(e(o({},this.props.data),{googledriveAccessTokens:l.target.value})),fullWidth:!0})):null)}}s.propTypes={socket:c().object.isRequired,themeType:c().string,themeName:c().string,style:c().object,className:c().string,data:c().object.isRequired,attr:c().string,schema:c().object,onError:c().func,onChange:c().func};const a=s},32149:(k,x,n)=>{n.d(x,{A:()=>l});var p=n(28437),i=n.n(p),A=n(95973),c=n.n(A),E=n(67085),W=n.n(E),y=n(37449),L=n.n(y),O=n(85903),U=Object.defineProperty,D=Object.defineProperties,P=Object.getOwnPropertyDescriptors,T=Object.getOwnPropertySymbols,M=Object.getPrototypeOf,R=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable,v=Reflect.get,o=(h,d,m)=>d in h?U(h,d,{enumerable:!0,configurable:!0,writable:!0,value:m}):h[d]=m,e=(h,d)=>{for(var m in d||(d={}))R.call(d,m)&&o(h,m,d[m]);if(T)for(var m of T(d))B.call(d,m)&&o(h,m,d[m]);return h},r=(h,d)=>D(h,P(d)),s=(h,d,m)=>v(M(h),m,d),a=(h,d,m)=>new Promise((I,b)=>{var _=f=>{try{u(m.next(f))}catch(C){b(C)}},g=f=>{try{u(m.throw(f))}catch(C){b(C)}},u=f=>f.done?I(f.value):Promise.resolve(f.value).then(_,g);u((m=m.apply(h,d)).next())});class t extends O.A{componentDidMount(){return a(this,null,function*(){s(t.prototype,this,"componentDidMount").call(this);const d=y.ConfigGeneric.getValue(this.props.data,this.props.attr),m=y.ConfigGeneric.getValue(this.props.data,this.props.schema.adapter==="telegram"?"telegramUser":"discordTarget"),b=Object.values(yield this.props.socket.getObjectViewCustom("system","instance",`system.adapter.${this.props.schema.adapter}.`,`system.adapter.${this.props.schema.adapter}.\u9999`)).map(_=>({value:_._id.substring(15),label:_._id.substring(15)}));b.unshift({value:"_",label:"none"}),this.setState({instances:b,instance:d,target:m},()=>{this.readTargets()})})}fillTelegramUser(){return a(this,null,function*(){var d;if((d=this.state.instance)!=null&&d.startsWith("telegram.")){if(this.instanceRead!==this.state.instance){let m=!1;const I=yield this.props.socket.getObject(`system.adapter.${this.state.instance}`);I&&I.native&&(m=I.native.useUsername);const b=yield this.props.socket.getState(`${this.state.instance}.communicate.users`),_=b==null?void 0:b.val,g=[{value:"allTelegramUsers",label:"All Receiver"}];if(_){this.instanceRead=this.state.target;const u=JSON.parse(_);for(const f in u)m?g.push({value:u[f].userName,label:u[f].userName}):g.push({value:u[f].firstName,label:u[f].firstName})}this.setState({targets:g})}}else this.props.data.telegramUser!=="allTelegramUsers"&&setTimeout(()=>this.props.onChange(r(e({},this.props.data),{telegramUser:"allTelegramUsers"})),50)})}fillDiscordTarget(){return a(this,null,function*(){var d;if((d=this.state.instance)!=null&&d.startsWith("discord.")){if(this.instanceRead!==this.state.instance){const m=yield this.props.socket.getState(`system.adapter.${this.state.instance}.alive`);if(m!=null&&m.val){const I=yield this.props.socket.sendTo(this.state.instance,"getNotificationTargets",{});if(Array.isArray(I)){this.instanceRead=this.state.instance;const b=[{value:"_",label:"none"}];for(const _ in I)b.push({value:I[_].value,label:I[_].label});this.setState({targets:b})}}}}else{const m=[{value:"_",label:"none"}];this.setState({targets:m}),this.props.data.discordTarget&&setTimeout(()=>this.props.onChange(r(e({},this.props.data),{discordTarget:""})),50)}})}readTargets(){return a(this,null,function*(){this.props.schema.adapter==="telegram"?yield this.fillTelegramUser():this.props.schema.adapter==="discord"&&(yield this.fillDiscordTarget())})}renderItem(){var d,m;const I=(d=this.state.instances)==null?void 0:d.find(_=>_.value===(this.state.instance||"")),b=(m=this.state.targets)==null?void 0:m.find(_=>_.value===(this.state.target||""));return i().createElement("div",{style:{width:"100%"}},this.state.instances?i().createElement(E.FormControl,{style:{width:"calc(50% - 5px)",marginRight:10},variant:"standard"},i().createElement(E.InputLabel,null,y.I18n.t(this.props.schema.label)),i().createElement(E.Select,{variant:"standard",value:this.state.instance||"_",renderValue:()=>this.getText(I==null?void 0:I.label,(I==null?void 0:I.label)!=="none"),onChange:_=>this.setState({instance:_.target.value==="_"?"":_.target.value},()=>{this.readTargets(),this.onChange(this.props.attr,this.state.value)})},this.state.instances.map((_,g)=>i().createElement(E.MenuItem,{key:g,value:_.value},this.getText(_.label,(_==null?void 0:_.label)!=="none")))),this.props.schema.help?i().createElement(E.FormHelperText,null,this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)):null):null,this.state.targets?i().createElement(E.FormControl,{style:{width:"calc(50% - 5px)"},variant:"standard"},i().createElement(E.InputLabel,null,y.I18n.t(this.props.schema.adapter==="telegram"?"Telegram Receiver":"Discord receiver")),i().createElement(E.Select,{disabled:!this.state.instance,variant:"standard",value:this.state.target||"_",renderValue:()=>this.getText(b==null?void 0:b.label,(b==null?void 0:b.label)!=="none"),onChange:_=>this.setState({target:_.target.value==="_"?"":_.target.value},()=>this.onChange(this.props.schema.adapter==="telegram"?"telegramUser":"discordTarget",this.state.target))},this.state.targets.map((_,g)=>i().createElement(E.MenuItem,{key:g,value:_.value},this.getText(_.label,(_==null?void 0:_.label)!=="none")))),this.props.schema.help?i().createElement(E.FormHelperText,null,this.renderHelp(this.props.schema.help,this.props.schema.helpLink,this.props.schema.noTranslation)):null):i().createElement(E.TextField,{style:{width:"calc(50% - 5px)"},variant:"standard",disabled:!this.state.instance,label:y.I18n.t(this.props.schema.adapter==="telegram"?"Telegram Receiver":"Discord receiver"),value:this.state.target,onChange:_=>this.setState({target:_.target.value},()=>this.onChange(this.props.schema.adapter==="telegram"?"telegramUser":"discordTarget",this.state.target))}))}}t.propTypes={socket:c().object.isRequired,themeType:c().string,themeName:c().string,style:c().object,className:c().string,data:c().object.isRequired,attr:c().string,schema:c().object,onError:c().func,onChange:c().func};const l=t}}]);

//# sourceMappingURL=src_AdapterExist_jsx-src_BackupNow_jsx-src_DetectConfig_jsx-src_DetectConfigInvisible_jsx-src-da93ea.95f3f24e.chunk.js.map